{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script type="text/javascript"  src='{% static "js/tareas/dash_tareas.js" %}'></script>
    <link rel="stylesheet" href='{% static "css/tareas/dash_tareas.css" %}' type="text/css">
    <title>Tareas</title>
</head>
<body>

<style>

</style>
    <h2>Tareas</h2>
    <div class="containerr">
      <nav>
        <ul> <!-- Este estilo se debe poner luego en el CSS. Estilo temporal para mejor visualidad -->
        <br>
          <li><p>Logo</p></li>
          <li><a href="{% url 'inicio' %}">Inicio</a></li>
          <li><a href="{% url 'inmu' %}">Inmuebles</a></li>
          <li>
            <select name="personas" id="personas" onchange="location.href=this.value;">
              <option value="1">Personas</option>
              <option value="{% url 'personas_propietarios' %}">Propietarios</option>
              <option value="{% url 'personas_inquilinos' %}">Inquilinos</option>>
            </select>
          </li>
          <li>
            <select name="analisis" id="analisis" onchange="location.href=this.value;">
              <option value="1">Analisis</option>
              <option value="{% url 'analisis_propietarios' %}">Propietarios</option>
              <option value="{% url 'analisis_inquilinos' %}">Inquilinos</option>
            </select>
          </li>
          <li><a href="#">Tareas</a></li>
          <br>
          <li><a href="{% url 'close_session' %}">Cerrar Sesión</a></li>
          <li><a href="{% url 'noti' %}">Notificaciones</a></li>
          <li><p>Foto</p></li>
        </ul>
      </nav>
    </div>
    <h2>Manejo de tareas y eventos</h2>
    <h3>Seguimiento de las tareas</h3>
    <h5>Todos las tareas Registradas en la plataforma</h5>
    <!-- Pendiente de preguntar en la siguiente reunión. -->
    <!-- <input type="search" id="buscar" name="buscar" placeholder="Buscar...">  --><button name="filtro" id="filtro" value="3">Filtrar</button> <a href="{% url 'AddTarea' %}"> + Añadir Tarea</a>
    <br>

    <h2>Pendientes</h2>
    <ul id="lista-tareas">
      {% for tarea in context.pendientes %}
      <button id="{{ tarea.id }}" value="{{ tarea.id }}"> 
        Etiqueta: {{ tarea.etiqueta }}
        <h3>Titulo: {{ tarea.titulo }}</h3>
        Fecha inicio: {{ tarea.fecha_inicio }} Fecha fin: {{ tarea.fecha_fin }}
        <h4>{{ tarea.superuser_id.nombre }} {{ tarea.superuser_id.apellido }}</h4></button><br>
      ----------------------------------------------------- <br><br><!-- Estos guiones solo son para guiarnos y saber cuando termina cada tarea -->
      {% endfor %}
    </ul>

    <h2>Completas</h2>
    <ul>
      {% for tarea in context.completas %}
        <li>Etiqueta: {{ tarea.etiqueta }}</li>
        <li><h3>Titulo: {{ tarea.titulo }}</h3></li>
        <li>Fecha incio: {{ tarea.fecha_inicio }}      Fecha fin: {{ tarea.fecha_fin }}</li>
        <h4>{{ tarea.superuser_id.nombre }} {{ tarea.superuser_id.apellido }}</h4>
        -----------------------------------------------------
      {% endfor %}
    </ul>

    <h2>Incompletas</h2>
    <ul>
      {% for tarea in context.incompletas %}
        <li>Etiqueta: {{ tarea.etiqueta }}</li>
        <li><h3>Titulo: {{ tarea.titulo }}</h3></li>
        <li>Fecha incio: {{ tarea.fecha_inicio }}      Fecha fin: {{ tarea.fecha_fin }}</li>
        <h4>{{ tarea.superuser_id.nombre }} {{ tarea.superuser_id.apellido }}</h4>
        -----------------------------------------------------
      {% endfor %}
    </ul><br><br><br>

    <div id="task-popup" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background-color: white; padding: 20px; border: 1px solid black;">
      <!-- Task details will be inserted here. -->
    </div>

<script>
  const tareaItems = document.querySelectorAll('.tarea-item');

tareaItems.forEach((tareaItem) => {
  tareaItem.addEventListener('click', () => {
    const taskId = tareaItem.getAttribute('data-id');
    // We'll use this ID to fetch task details later.
  });
});

async function fetchTaskDetails(taskId) {
  const response = await fetch(`/task/${taskId}/details/`);
  const data = await response.json();
  return data;
}

function displayTaskDetails(taskDetails) {
  const popup = document.getElementById('task-popup');
  popup.innerHTML = `
    <h3>${taskDetails.title}</h3>
    <p>${taskDetails.description}</p>
    <p>Due Date: ${taskDetails.due_date}</p>
  `;
  popup.style.display = 'block';
}

areaItems.forEach((tareaItem) => {
  tareaItem.addEventListener('click', async () => {
    const taskId = tareaItem.getAttribute('data-id');
    const taskDetails = await fetchTaskDetails(taskId);
    displayTaskDetails(taskDetails);
  });
});
</script>
</body>
</html>